!function(){"use strict";var e="abcdefgh".split("");function n(e){if("string"!=typeof e)return!1;var n=e.split("-");return 2===n.length&&(!0===r(n[0])&&!0===r(n[1]))}function r(e){return"string"==typeof e&&-1!==e.search(/^[a-h][1-8]$/)}function t(e){if("string"!=typeof e)return!1;var n=(e=e.replace(/ .+$/,"")).split("/");if(8!==n.length)return!1;for(var r=0;r<8;r++)if(""===n[r]||n[r].length>8||-1!==n[r].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function o(e){if("object"!=typeof e)return!1;for(var n in e)if(!0===e.hasOwnProperty(n)&&(!0!==r(n)||!0!=("string"==typeof(t=e[n])&&-1!==t.search(/^[bw][KQRNBP]$/))))return!1;var t;return!0}function a(n){if(!0!==t(n))return!1;for(var r,o=(n=n.replace(/ .+$/,"")).split("/"),a={},i=8,s=0;s<8;s++){for(var p=o[s].split(""),c=0,f=0;f<p.length;f++){if(-1!==p[f].search(/[1-8]/))c+=parseInt(p[f],10);else a[e[c]+i]=(r=p[f]).toLowerCase()===r?"b"+r.toUpperCase():"w"+r.toUpperCase(),c++}i--}return a}function i(n){if(!0!==o(n))return!1;for(var r,t,a="",i=8,s=0;s<8;s++){for(var p=0;p<8;p++){var c=e[p]+i;!0===n.hasOwnProperty(c)?a+=(r=n[c],t=void 0,"w"===(t=r.split(""))[0]?t[1].toUpperCase():t[1].toLowerCase()):a+="1"}7!==s&&(a+="/"),i--}return a=(a=(a=(a=(a=(a=(a=a.replace(/11111111/g,"8")).replace(/1111111/g,"7")).replace(/111111/g,"6")).replace(/11111/g,"5")).replace(/1111/g,"4")).replace(/111/g,"3")).replace(/11/g,"2")}window.ChessBoard=window.ChessBoard||function(s,p){p=p||{};var c,f,u,d,h,l,v,g,w,y,m="1.7.0",b=a("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),P={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},x={},O=2,S="white",E={},q=!1,B={},k={};function C(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function T(e){return JSON.parse(JSON.stringify(e))}function N(e){var n=e.split(".");return{major:parseInt(n[0],10),minor:parseInt(n[1],10),patch:parseInt(n[2],10)}}function I(e,n,r){if(!0===p.hasOwnProperty("showErrors")&&!1!==p.showErrors){var t="ChessBoard Error "+e+": "+n;return"console"===p.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(t),void(arguments.length>=2&&console.log(r))):"alert"===p.showErrors?(r&&(t+="\n\n"+JSON.stringify(r)),void window.alert(t)):void("function"==typeof p.showErrors&&p.showErrors(e,n,r))}}function M(){if("string"==typeof s){if(""===s)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var e=document.getElementById(s);if(!e)return window.alert('ChessBoard Error 1002: Element with id "'+s+'" does not exist in the DOM.\n\nExiting...'),!1;c=$(e)}else if(1!==(c=$(s)).length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;return window.JSON&&"function"==typeof JSON.stringify&&"function"==typeof JSON.parse?(window.$,!(!$.fn||!$.fn.jquery||!0!=(n=$.fn.jquery,r=m,n=N(n),r=N(r),1e4*n.major*1e4+1e4*n.minor+n.patch>=1e4*r.major*1e4+1e4*r.minor+r.patch))||(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+m+" or higher on the page.\n\nExiting..."),!1)):(window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1);var n,r}function D(e){return"fast"===e||"slow"===e||parseInt(e,10)+""==e+""&&e>=0}var j={};function Q(){["wK","wQ","wR","wB","wN","wP","bK","bQ","bR","bB","bN","bP"].forEach(function(e){var n=new Image;n.onload=function(){j[e]=function(e){var n=document.createElement("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),n.toDataURL("image/png")}(n)},n.src=R(e)})}function R(e){return j[e]?j[e]:function(e){if("function"==typeof p.pieceTheme)return p.pieceTheme(e);if("string"==typeof p.pieceTheme)return p.pieceTheme.replace(/{piece}/g,e);return I(8272,"Unable to build image source for cfg.pieceTheme."),""}(e)}function J(e,n,r){var t='<img src="'+R(e)+'" ';return r&&"string"==typeof r&&(t+='id="'+r+'" '),t+='alt="" class="'+P.piece+'" data-piece="'+e+'" style="width: '+l+"px;height: "+l+"px;",!0===n&&(t+="display:none;"),t+='" />'}function K(e){var n=["wK","wQ","wR","wB","wN","wP"];"black"===e&&(n=["bK","bQ","bR","bB","bN","bP"]);for(var r="",t=0;t<n.length;t++)r+=J(n[t],!1,B[n[t]]);return r}function X(e,n,r,t){var o=$("#"+k[e]),a=o.offset(),i=$("#"+k[n]),s=i.offset(),c=C();$("body").append(J(r,!0,c));var f=$("#"+c);f.css({display:"",position:"absolute",top:a.top,left:a.left}),o.find("."+P.piece).remove();var u={duration:p.moveSpeed,complete:function(){i.append(J(r)),f.remove(),"function"==typeof t&&t()}};f.animate(s,u)}function Y(e,n,r){var t=$("#"+B[e]).offset(),o=$("#"+k[n]),a=o.offset(),i=C();$("body").append(J(e,!0,i));var s=$("#"+i);s.css({display:"",position:"absolute",left:t.left,top:t.top});var c={duration:p.moveSpeed,complete:function(){o.find("."+P.piece).remove(),o.append(J(e)),s.remove(),"function"==typeof r&&r()}};s.animate(a,c)}function L(n,r){n=n.split("");var t=e.indexOf(n[0])+1,o=parseInt(n[1],10);r=r.split("");var a=e.indexOf(r[0])+1,i=parseInt(r[1],10),s=Math.abs(t-a),p=Math.abs(o-i);return s>=p?s:p}function U(n,r,t){for(var o=function(n){for(var r=[],t=0;t<8;t++)for(var o=0;o<8;o++){var a=e[t]+(o+1);n!==a&&r.push({square:a,distance:L(n,a)})}r.sort(function(e,n){return e.distance-n.distance});var i=[];for(t=0;t<r.length;t++)i.push(r[t].square);return i}(t),a=0;a<o.length;a++){var i=o[a];if(!0===n.hasOwnProperty(i)&&n[i]===r)return i}return!1}function z(){for(var e in f.find("."+P.piece).remove(),E)!0===E.hasOwnProperty(e)&&(q&&w==e||$("#"+k[e]).append(J(E[e])))}function A(){f.html(function(n){"black"!==n&&(n="white");var r="",t=T(e),o=8;"black"===n&&(t.reverse(),o=1);for(var a="white",i=0;i<8;i++){r+='<div class="'+P.row+'">';for(var s=0;s<8;s++){var c=t[s]+o;r+='<div class="'+P.square+" "+P[a]+" square-"+c+'" style="width: '+l+"px; height: "+l+'px" id="'+k[c]+'" data-square="'+c+'">',!0===p.showNotation&&(("white"===n&&1===o||"black"===n&&8===o)&&(r+='<div class="'+P.notation+" "+P.alpha+'">'+t[s]+"</div>"),0===s&&(r+='<div class="'+P.notation+" "+P.numeric+'">'+o+"</div>")),r+="</div>",a="white"===a?"black":"white"}r+='<div class="'+P.clearfix+'"></div></div>',a="white"===a?"black":"white","white"===n?o--:o++}return r}(S)),z(),!0===p.sparePieces&&("white"===S?(d.html(K("black")),h.html(K("white"))):(d.html(K("white")),h.html(K("black"))))}function F(e){var n=T(E),r=T(e);i(n)!==i(r)&&(!0===p.hasOwnProperty("onChange")&&"function"==typeof p.onChange&&p.onChange(n,r),E=e)}function W(e,n){for(var r in y)if(!0===y.hasOwnProperty(r)){var t=y[r];if(e>=t.left&&e<t.left+l&&n>=t.top&&n<t.top+l)return r}return"offboard"}function G(){f.find("."+P.square).removeClass(P.highlight1+" "+P.highlight2)}function H(){G();var e=T(E);delete e[w],F(e),z(),u.fadeOut(p.trashSpeed),q=!1}function V(e,n,r,t){"function"==typeof p.onDragStart&&!1===p.onDragStart(e,n,T(E),S)||(q=!0,v=n,w=e,g="spare"===e?"offboard":e,function(){for(var e in y={},k)!0===k.hasOwnProperty(e)&&(y[e]=$("#"+k[e]).offset())}(),u.attr("src",R(n)).css({display:"",position:"absolute",left:r-l/2,top:t-l/2}),"spare"!==e&&$("#"+k[e]).addClass(P.highlight1).find("."+P.piece).css("display","none"))}function Z(e,n){u.css({left:e-l/2,top:n-l/2});var t=W(e,n);t!==g&&(!0===r(g)&&$("#"+k[g]).removeClass(P.highlight2),!0===r(t)&&$("#"+k[t]).addClass(P.highlight2),"function"==typeof p.onDragMove&&p.onDragMove(t,g,w,v,T(E),S),g=t)}function _(e){var n="drop";if("offboard"===e&&"snapback"===p.dropOffBoard&&(n="snapback"),"offboard"===e&&"trash"===p.dropOffBoard&&(n="trash"),!0===p.hasOwnProperty("onDrop")&&"function"==typeof p.onDrop){var t=T(E);"spare"===w&&!0===r(e)&&(t[e]=v),!0===r(w)&&"offboard"===e&&delete t[w],!0===r(w)&&!0===r(e)&&(delete t[w],t[e]=v);var o=T(E),a=p.onDrop(w,e,v,t,o,S);"snapback"!==a&&"trash"!==a||(n=a)}"snapback"===n?function(){if("spare"!==w){G();var e=$("#"+k[w]).offset(),n={duration:p.snapbackSpeed,complete:function(){z(),u.css("display","none"),!0===p.hasOwnProperty("onSnapbackEnd")&&"function"==typeof p.onSnapbackEnd&&p.onSnapbackEnd(v,w,T(E),S)}};u.animate(e,n),q=!1}else H()}():"trash"===n?H():"drop"===n&&function(e){G();var n=T(E);delete n[w],n[e]=v,F(n);var r=$("#"+k[e]).offset(),t={duration:p.snapSpeed,complete:function(){z(),u.css("display","none"),!0===p.hasOwnProperty("onSnapEnd")&&"function"==typeof p.onSnapEnd&&p.onSnapEnd(w,e,v)}};u.animate(r,t),q=!1}(e)}function ee(e){e.preventDefault()}function ne(e){if(!0===p.draggable){var n=$(this).attr("data-square");!0===r(n)&&!0===E.hasOwnProperty(n)&&V(n,E[n],e.pageX,e.pageY)}}function re(e){if(!0===p.draggable){var n=$(this).attr("data-square");!0===r(n)&&!0===E.hasOwnProperty(n)&&(e=e.originalEvent,V(n,E[n],e.changedTouches[0].pageX,e.changedTouches[0].pageY))}}function te(e){!0===p.sparePieces&&V("spare",$(this).attr("data-piece"),e.pageX,e.pageY)}function oe(e){!0===p.sparePieces&&V("spare",$(this).attr("data-piece"),(e=e.originalEvent).changedTouches[0].pageX,e.changedTouches[0].pageY)}function ae(e){!0===q&&Z(e.pageX,e.pageY)}function ie(e){!0===q&&(e.preventDefault(),Z(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function se(e){!0===q&&_(W(e.pageX,e.pageY))}function pe(e){!0===q&&_(W(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function ce(e){if(!1===q&&!0===p.hasOwnProperty("onMouseoverSquare")&&"function"==typeof p.onMouseoverSquare){var n=$(e.currentTarget).attr("data-square");if(!0===r(n)){var t=!1;!0===E.hasOwnProperty(n)&&(t=E[n]),p.onMouseoverSquare(n,t,T(E),S)}}}function fe(e){if(!1===q&&!0===p.hasOwnProperty("onMouseoutSquare")&&"function"==typeof p.onMouseoutSquare){var n=$(e.currentTarget).attr("data-square");if(!0===r(n)){var t=!1;!0===E.hasOwnProperty(n)&&(t=E[n]),p.onMouseoutSquare(n,t,T(E),S)}}}function ue(){$("body").on("mousedown mousemove","."+P.piece,ee),f.on("mousedown","."+P.square,ne),c.on("mousedown","."+P.sparePieces+" ."+P.piece,te),f.on("mouseenter","."+P.square,ce).on("mouseleave","."+P.square,fe),!0===(navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/))?(document.ondragstart=function(){return!1},$("body").on("mousemove",ae).on("mouseup",se)):$(window).on("mousemove",ae).on("mouseup",se),"ontouchstart"in document.documentElement==!0&&(f.on("touchstart","."+P.square,re),c.on("touchstart","."+P.sparePieces+" ."+P.piece,oe),$(window).on("touchmove",ie).on("touchend",pe))}function de(){var n;!function(){for(var n=0;n<e.length;n++)for(var r=1;r<=8;r++){var t=e[n]+r;k[t]=t+"-"+C()}var o="KQRBNP".split("");for(n=0;n<o.length;n++){var a="w"+o[n],i="b"+o[n];B[a]=a+"-"+C(),B[i]=i+"-"+C()}}(),Q(),c.html((n='<div class="'+P.chessboard+'">',!0===p.sparePieces&&(n+='<div class="'+P.sparePieces+" "+P.sparePiecesTop+'"></div>'),n+='<div class="'+P.board+'"></div>',!0===p.sparePieces&&(n+='<div class="'+P.sparePieces+" "+P.sparePiecesBottom+'"></div>'),n+="</div>")),f=c.find("."+P.board),!0===p.sparePieces&&(d=c.find("."+P.sparePiecesTop),h=c.find("."+P.sparePiecesBottom));var r=C();$("body").append(J("wP",!0,r)),u=$("#"+r),O=parseInt(f.css("borderLeftWidth"),10),x.resize()}return x.clear=function(e){x.position({},e)},x.destroy=function(){c.html(""),u.remove(),c.unbind()},x.fen=function(){return x.position("fen")},x.flip=function(){return x.orientation("flip")},x.cache=Q,x.move=function(){if(0!==arguments.length){for(var e=!0,r={},t=0;t<arguments.length;t++)if(!1!==arguments[t])if(!0===n(arguments[t])){var o=arguments[t].split("-");r[o[0]]=o[1]}else I(2826,"Invalid move passed to the move method.",arguments[t]);else e=!1;var a=function(e,n){for(var r in e=T(e),n)if(!0===n.hasOwnProperty(r)&&!0===e.hasOwnProperty(r)){var t=e[r];delete e[r],e[n[r]]=t}return e}(E,r);return x.position(a,e),a}},x.orientation=function(e){return 0===arguments.length?S:"white"===e||"black"===e?(S=e,A(),S):"flip"===e?(S="white"===S?"black":"white",A(),S):void I(5482,"Invalid value passed to the orientation method.",e)},x.position=function(e,n){return 0===arguments.length?T(E):"string"==typeof e&&"fen"===e.toLowerCase()?i(E):(!1!==n&&(n=!0),"string"==typeof e&&"start"===e.toLowerCase()&&(e=T(b)),!0===t(e)&&(e=a(e)),void(!0===o(e)?!0===n?(!function(e,n,r){!0;var t=0;function o(){++t===e.length&&(z(),!1,!0===p.hasOwnProperty("onMoveEnd")&&"function"==typeof p.onMoveEnd&&p.onMoveEnd(T(n),T(r)))}for(var a=0;a<e.length;a++)"clear"===e[a].type&&$("#"+k[e[a].square]+" ."+P.piece).fadeOut(p.trashSpeed,o),"add"===e[a].type&&!0!==p.sparePieces&&$("#"+k[e[a].square]).append(J(e[a].piece,!0)).find("."+P.piece).fadeIn(p.appearSpeed,o),"add"===e[a].type&&!0===p.sparePieces&&Y(e[a].piece,e[a].square,o),"move"===e[a].type&&X(e[a].source,e[a].destination,e[a].piece,o)}(function(e,n){e=T(e),n=T(n);var r=[],t={};for(var o in n)!0===n.hasOwnProperty(o)&&!0===e.hasOwnProperty(o)&&e[o]===n[o]&&(delete e[o],delete n[o]);for(var o in n)if(!0===n.hasOwnProperty(o)){var a=U(e,n[o],o);!1!==a&&(r.push({type:"move",source:a,destination:o,piece:n[o]}),delete e[a],delete n[o],t[o]=!0)}for(var o in n)!0===n.hasOwnProperty(o)&&(r.push({type:"add",square:o,piece:n[o]}),delete n[o]);for(var o in e)!0===e.hasOwnProperty(o)&&!0!==t.hasOwnProperty(o)&&(r.push({type:"clear",square:o,piece:e[o]}),delete e[o]);return r}(E,e),E,e),F(e)):(F(e),z()):I(6482,"Invalid value passed to the position method.",e)))},x.resize=function(){l=function(){var e=parseInt(c.width(),10);if(!e||e<=0)return 0;for(var n=e-1;n%8!=0&&n>0;)n--;return n/8}(),f.css("width",8*l+"px"),u.css({height:l,width:l}),!0===p.sparePieces&&c.find("."+P.sparePieces).css("paddingLeft",l+O+"px"),A()},x.start=function(e){x.position("start",e)},!0===M()&&1==("string"!=typeof p&&!0!==o(p)||(p={position:p}),"black"!==p.orientation&&(p.orientation="white"),S=p.orientation,!1!==p.showNotation&&(p.showNotation=!0),!0!==p.draggable&&(p.draggable=!1),"trash"!==p.dropOffBoard&&(p.dropOffBoard="snapback"),!0!==p.sparePieces&&(p.sparePieces=!1),!0===p.sparePieces&&(p.draggable=!0),(!0!==p.hasOwnProperty("pieceTheme")||"string"!=typeof p.pieceTheme&&"function"!=typeof p.pieceTheme)&&(p.pieceTheme="img/chesspieces/wikipedia/{piece}.svg"),!0===p.hasOwnProperty("appearSpeed")&&!0===D(p.appearSpeed)||(p.appearSpeed=200),!0===p.hasOwnProperty("moveSpeed")&&!0===D(p.moveSpeed)||(p.moveSpeed=200),!0===p.hasOwnProperty("snapbackSpeed")&&!0===D(p.snapbackSpeed)||(p.snapbackSpeed=50),!0===p.hasOwnProperty("snapSpeed")&&!0===D(p.snapSpeed)||(p.snapSpeed=25),!0===p.hasOwnProperty("trashSpeed")&&!0===D(p.trashSpeed)||(p.trashSpeed=100),!0===p.hasOwnProperty("position")&&("start"===p.position?E=T(b):!0===t(p.position)?E=a(p.position):!0===o(p.position)?E=T(p.position):I(7263,"Invalid value passed to config.position.",p.position)),!0)&&(de(),ue()),x},window.ChessBoard.fenToObj=a,window.ChessBoard.objToFen=i}();